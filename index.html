<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HealthCheck - Smart Lab Booking</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
        }

        .test-card:hover {
            transform: translateY(-2px);
            transition: all 0.2s ease;
        }

        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 10px;
        }

        .optimization-alert {
            animation: pulse-border 2s infinite;
        }

        @keyframes pulse-border {
            0% { border-color: #3b82f6; box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.4); }
            70% { border-color: #3b82f6; box-shadow: 0 0 0 10px rgba(59, 130, 246, 0); }
            100% { border-color: #3b82f6; box-shadow: 0 0 0 0 rgba(59, 130, 246, 0); }
        }

        .modal-overlay {
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
        }
    </style>
</head>
<body class="text-slate-800">

    <!-- Header -->
    <header class="bg-white border-b sticky top-0 z-40">
        <div class="max-w-6xl mx-auto px-4 h-16 flex items-center justify-between">
            <div class="flex items-center gap-2">
                <div class="w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center text-white">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m12 14 4-4"/><path d="M3.34 19a10 10 0 1 1 17.32 0"/><path d="m9.05 14.87 2.02-2.02a2 2 0 0 1 2.86 0l2.02 2.02"/><path d="m14.47 16.75 2.1 2.1"/><path d="m9.43 16.75-2.1 2.1"/></svg>
                </div>
                <h1 class="text-xl font-bold tracking-tight text-slate-900">My Lab Buddy (MLB)</h1>
            </div>
            
            <button onclick="toggleCart()" class="relative p-2 text-slate-600 hover:text-blue-600 transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="8" cy="21" r="1"/><circle cx="19" cy="21" r="1"/><path d="M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12"/></svg>
                <span id="cart-count" class="absolute -top-1 -right-1 bg-red-500 text-white text-[10px] font-bold px-1.5 py-0.5 rounded-full hidden">0</span>
            </button>
        </div>
    </header>

    <main class="max-w-6xl mx-auto px-4 py-8">
        <!-- Search Section -->
        <section class="mb-12">
            <div class="max-w-2xl mx-auto text-center">
                <h2 class="text-3xl font-extrabold text-slate-900 mb-4">Find Your Medical Tests</h2>
                <p class="text-slate-600 mb-8">Add multiple tests to your cart. We'll automatically find the best packages to save you money.</p>
                
                <div class="relative group">
                    <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none text-slate-400 group-focus-within:text-blue-500">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>
                    </div>
                    <input 
                        type="text" 
                        id="test-search"
                        placeholder="Search e.g. Vitamin D, CBC, Liver Function..."
                        class="w-full pl-12 pr-4 py-4 bg-white border border-slate-200 rounded-2xl shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
                        oninput="searchTests(this.value)"
                    >
                    <div id="search-results" class="absolute w-full mt-2 bg-white border border-slate-200 rounded-xl shadow-xl z-30 hidden max-h-80 overflow-y-auto custom-scrollbar">
                        <!-- Results will be injected here -->
                    </div>
                </div>
            </div>
        </section>

        <!-- Main Content Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            
            <!-- Left Side: Active Cart & Recommendations -->
            <div class="lg:col-span-2 space-y-6">
                
                <!-- Optimization Recommendation (Conditional) -->
                <div id="optimization-container" class="hidden">
                    <div class="bg-blue-50 border-2 border-blue-200 rounded-2xl p-6 optimization-alert">
                        <div class="flex items-start gap-4">
                            <div class="bg-blue-100 p-3 rounded-full text-blue-600">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/><path d="M5 3v4"/><path d="M19 17v4"/><path d="M3 5h4"/><path d="M17 19h4"/></svg>
                            </div>
                            <div class="flex-1">
                                <h3 class="text-blue-900 font-bold text-lg mb-1">Smart Suggestion!</h3>
                                <p id="opt-message" class="text-blue-800 text-sm mb-4"></p>
                                <div id="opt-package-card" class="bg-white border border-blue-100 rounded-xl p-4 flex justify-between items-center">
                                    <!-- Package snippet injected here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Current Selection -->
                <div class="bg-white rounded-2xl border border-slate-200 overflow-hidden">
                    <div class="px-6 py-4 border-b border-slate-100 flex justify-between items-center">
                        <h3 class="font-bold text-slate-800">Your Selected Tests</h3>
                        <span id="selected-count" class="text-xs font-medium text-slate-500 uppercase tracking-wider">0 Items</span>
                    </div>
                    <div id="cart-items" class="p-6 space-y-4 min-h-[200px]">
                        <!-- Selected tests will appear here -->
                        <div id="empty-cart-state" class="flex flex-col items-center justify-center py-12 text-slate-400">
                            <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="mb-4"><circle cx="8" cy="21" r="1"/><circle cx="19" cy="21" r="1"/><path d="M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12"/></svg>
                            <p>No tests added yet. Start searching above!</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Side: Order Summary -->
            <div class="lg:col-span-1">
                <div class="bg-white rounded-2xl border border-slate-200 p-6 sticky top-24">
                    <h3 class="font-bold text-slate-800 mb-6 text-lg">Order Summary</h3>
                    <div class="space-y-4 mb-6">
                        <div class="flex justify-between text-slate-600">
                            <span>Subtotal</span>
                            <span id="summary-subtotal">₹0</span>
                        </div>
                        <div class="flex justify-between text-slate-600">
                            <span>Home Collection</span>
                            <span class="text-green-600 font-medium">FREE</span>
                        </div>
                        <div class="pt-4 border-t border-slate-100 flex justify-between items-center">
                            <span class="font-bold text-slate-900">Total Amount</span>
                            <span id="summary-total" class="text-2xl font-bold text-blue-600">₹0</span>
                        </div>
                    </div>
                    <button class="w-full py-4 bg-slate-900 text-white rounded-xl font-bold hover:bg-slate-800 transition-colors disabled:opacity-50 disabled:cursor-not-allowed" id="checkout-btn" disabled>
                        Proceed to Booking
                    </button>
                    <p class="text-center text-[10px] text-slate-400 mt-4 uppercase tracking-widest font-medium">Safe & Secure 256-bit Encryption</p>
                </div>
            </div>
        </div>
    </main>

    <!-- Package Detail Modal -->
    <div id="package-modal" class="fixed inset-0 z-50 hidden flex items-center justify-center p-4">
        <div class="absolute inset-0 modal-overlay" onclick="closeModal()"></div>
        <div class="bg-white rounded-3xl w-full max-w-lg relative z-10 overflow-hidden shadow-2xl">
            <div id="modal-content">
                <!-- Injected content -->
            </div>
        </div>
    </div>

    <script>
        // --- Data Definitions ---
        const INDIVIDUAL_TESTS = [
            { id: 't1', name: 'Complete Blood Count (CBC)', price: 450, desc: 'Includes Hemoglobin, WBC, Platelets, etc.' },
            { id: 't2', name: 'Vitamin D (25-OH)', price: 1200, desc: 'Checks for bone health and immunity.' },
            { id: 't3', name: 'HbA1c (Diabetes)', price: 600, desc: 'Average blood sugar over 3 months.' },
            { id: 't4', name: 'Liver Function Test (LFT)', price: 900, desc: 'Enzymes and proteins in your liver.' },
            { id: 't5', name: 'Kidney Function Test (KFT)', price: 850, desc: 'Urea, Creatinine and Electrolytes.' },
            { id: 't6', name: 'Lipid Profile', price: 750, desc: 'Cholesterol, HDL, LDL, and Triglycerides.' },
            { id: 't7', name: 'Thyroid Profile (T3, T4, TSH)', price: 650, desc: 'Screening for thyroid disorders.' },
            { id: 't8', name: 'Vitamin B12', price: 1100, desc: 'Essential for nerve function and energy.' },
            { id: 't9', name: 'Iron Studies', price: 950, desc: 'Iron, TIBC, and Ferritin levels.' },
            { id: 't10', name: 'Urine Routine', price: 200, desc: 'Checks for UTI and kidney health.' }
        ];

        const PACKAGES = [
            {
                id: 'p1',
                name: 'Basic Wellness Bundle',
                price: 1800,
                tests: ['t1', 't3', 't4', 't5'], // CBC, HbA1c, LFT, KFT
                savings: 1000,
                recommended: false
            },
            {
                id: 'p2',
                name: 'Essential Vitamin Duo',
                price: 1900,
                tests: ['t2', 't8'], // Vit D, Vit B12
                savings: 400,
                recommended: true
            },
            {
                id: 'p3',
                name: 'Advanced Full Body Checkup',
                price: 3500,
                tests: ['t1', 't2', 't3', 't4', 't5', 't6', 't7', 't10'],
                savings: 2750,
                recommended: true
            }
        ];

        // --- State ---
        let cart = []; // Array of items (can be test or package)
        
        // --- Core Functions ---

        function searchTests(query) {
            const resultsDiv = document.getElementById('search-results');
            if (!query.trim()) {
                resultsDiv.classList.add('hidden');
                return;
            }

            const filtered = INDIVIDUAL_TESTS.filter(t => 
                t.name.toLowerCase().includes(query.toLowerCase())
            );

            if (filtered.length === 0) {
                resultsDiv.innerHTML = `<div class="p-4 text-slate-500 italic">No tests found matching "${query}"</div>`;
            } else {
                resultsDiv.innerHTML = filtered.map(test => `
                    <div onclick="addToCart('${test.id}', 'test')" class="p-4 border-b border-slate-50 last:border-0 hover:bg-blue-50 cursor-pointer flex justify-between items-center transition-colors">
                        <div>
                            <div class="font-semibold text-slate-800">${test.name}</div>
                            <div class="text-xs text-slate-500">${test.desc}</div>
                        </div>
                        <div class="flex items-center gap-3">
                            <span class="font-bold text-blue-600">₹${test.price}</span>
                            <div class="w-8 h-8 rounded-full bg-slate-100 flex items-center justify-center text-slate-600 hover:bg-blue-600 hover:text-white transition-all">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14"/><path d="M12 5v14"/></svg>
                            </div>
                        </div>
                    </div>
                `).join('');
            }
            resultsDiv.classList.remove('hidden');
        }

        function addToCart(id, type) {
            // Check if already in cart
            if (cart.find(item => item.id === id)) {
                showMessage("Item already in cart");
                document.getElementById('search-results').classList.add('hidden');
                document.getElementById('test-search').value = '';
                return;
            }

            const data = type === 'test' 
                ? INDIVIDUAL_TESTS.find(t => t.id === id) 
                : PACKAGES.find(p => p.id === id);

            cart.push({ ...data, type });
            updateUI();
            
            // Clean up search
            document.getElementById('search-results').classList.add('hidden');
            document.getElementById('test-search').value = '';
        }

        function removeFromCart(id) {
            cart = cart.filter(item => item.id !== id);
            updateUI();
        }

        function updateUI() {
            renderCart();
            calculateSummary();
            checkOptimization();
            
            const count = cart.length;
            const badge = document.getElementById('cart-count');
            badge.innerText = count;
            badge.classList.toggle('hidden', count === 0);
            document.getElementById('selected-count').innerText = `${count} Items`;
            document.getElementById('checkout-btn').disabled = count === 0;
        }

        function renderCart() {
            const container = document.getElementById('cart-items');
            const emptyState = document.getElementById('empty-cart-state');

            if (cart.length === 0) {
                container.innerHTML = '';
                container.appendChild(emptyState);
                return;
            }

            container.innerHTML = cart.map(item => `
                <div class="group relative flex items-center justify-between p-4 rounded-xl border border-slate-100 hover:border-blue-200 hover:bg-blue-50/30 transition-all">
                    <div class="flex items-center gap-4">
                        <div class="${item.type === 'package' ? 'bg-orange-100 text-orange-600' : 'bg-blue-100 text-blue-600'} w-10 h-10 rounded-lg flex items-center justify-center">
                             ${item.type === 'package' ? 
                                '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m7.5 4.27 9 5.15"/><path d="M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z"/><path d="m3.3 7 8.7 5 8.7-5"/><path d="M12 22V12"/></svg>' : 
                                '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2v20"/><path d="M5 12h14"/></svg>'}
                        </div>
                        <div>
                            <h4 class="font-bold text-slate-800">${item.name}</h4>
                            <p class="text-xs text-slate-500">${item.type === 'package' ? item.tests.length + ' Tests included' : item.desc}</p>
                            ${item.type === 'package' ? `<button onclick="viewPackageDetails('${item.id}')" class="text-xs text-blue-600 font-semibold mt-1 hover:underline">View Included Tests</button>` : ''}
                        </div>
                    </div>
                    <div class="flex items-center gap-4">
                        <span class="font-bold text-slate-900">₹${item.price}</span>
                        <button onclick="removeFromCart('${item.id}')" class="text-slate-300 hover:text-red-500 transition-colors">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></svg>
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function calculateSummary() {
            const subtotal = cart.reduce((sum, item) => sum + item.price, 0);
            document.getElementById('summary-subtotal').innerText = `₹${subtotal}`;
            document.getElementById('summary-total').innerText = `₹${subtotal}`;
        }

        /**
         * The "Smart Engine"
         * Checks if the user's current tests are part of a package.
         */
        function checkOptimization() {
            const container = document.getElementById('optimization-container');
            const currentTestIds = cart.filter(i => i.type === 'test').map(i => i.id);
            
            if (currentTestIds.length < 2) {
                container.classList.add('hidden');
                return;
            }

            let bestMatch = null;
            let matchScore = 0;

            PACKAGES.forEach(pkg => {
                // Find how many tests in the current cart are in this package
                const matchedInPkg = pkg.tests.filter(tId => currentTestIds.includes(tId));
                
                // If we match 2 or more tests, or significant portion, suggest it
                if (matchedInPkg.length >= 2 && matchedInPkg.length > matchScore) {
                    matchScore = matchedInPkg.length;
                    bestMatch = pkg;
                }
            });

            if (bestMatch) {
                const totalIndividualPrice = bestMatch.tests
                    .filter(tid => currentTestIds.includes(tid))
                    .reduce((sum, tid) => sum + INDIVIDUAL_TESTS.find(t => t.id === tid).price, 0);

                // Only suggest if the package actually saves money compared to current cart subset
                // OR if it offers significantly more for a small price bump
                document.getElementById('opt-message').innerHTML = `You have added <strong>${matchScore} tests</strong> that are part of our <strong>${bestMatch.name}</strong>. Switching could save you significantly!`;
                
                document.getElementById('opt-package-card').innerHTML = `
                    <div class="flex-1">
                        <div class="text-sm font-bold text-slate-800">${bestMatch.name}</div>
                        <div class="text-[10px] text-slate-500 uppercase tracking-tighter">Covers ${bestMatch.tests.length} Total Tests</div>
                    </div>
                    <div class="text-right flex items-center gap-4">
                        <div>
                            <div class="text-lg font-bold text-blue-600 leading-none">₹${bestMatch.price}</div>
                            <div class="text-[10px] text-green-600 font-bold">SAVE ₹${bestMatch.savings}+</div>
                        </div>
                        <button onclick="applyOptimization('${bestMatch.id}')" class="bg-blue-600 text-white px-4 py-2 rounded-lg text-sm font-bold hover:bg-blue-700 transition-colors">
                            Apply Bundle
                        </button>
                    </div>
                `;
                container.classList.remove('hidden');
            } else {
                container.classList.add('hidden');
            }
        }

        function applyOptimization(pkgId) {
            const pkg = PACKAGES.find(p => p.id === pkgId);
            
            // Remove the individual tests that are part of this package
            cart = cart.filter(item => {
                if (item.type === 'test' && pkg.tests.includes(item.id)) return false;
                return true;
            });

            // Add the package
            addToCart(pkgId, 'package');
            showMessage(`${pkg.name} bundle applied!`);
        }

        // --- Modal/Pop-up Functions ---

        function viewPackageDetails(pkgId) {
            const pkg = PACKAGES.find(p => p.id === pkgId);
            const modal = document.getElementById('package-modal');
            const content = document.getElementById('modal-content');

            const testList = pkg.tests.map(tid => INDIVIDUAL_TESTS.find(t => t.id === tid));

            content.innerHTML = `
                <div class="p-8">
                    <div class="flex justify-between items-start mb-6">
                        <div>
                            <h2 class="text-2xl font-bold text-slate-900">${pkg.name}</h2>
                            <p class="text-slate-500">Comprehensive health screening</p>
                        </div>
                        <button onclick="closeModal()" class="text-slate-400 hover:text-slate-600">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
                        </button>
                    </div>
                    
                    <div class="space-y-4 max-h-96 overflow-y-auto pr-2 custom-scrollbar">
                        <h4 class="text-xs font-bold text-slate-400 uppercase tracking-widest">Included Tests (${testList.length})</h4>
                        ${testList.map(test => `
                            <div class="flex items-start gap-3 p-3 bg-slate-50 rounded-xl">
                                <div class="mt-1 text-green-500">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><path d="M20 6 9 17l-5-5"/></svg>
                                </div>
                                <div>
                                    <div class="font-bold text-slate-800 text-sm">${test.name}</div>
                                    <div class="text-xs text-slate-500">${test.desc}</div>
                                </div>
                            </div>
                        `).join('')}
                    </div>

                    <div class="mt-8 pt-6 border-t border-slate-100 flex items-center justify-between">
                        <div>
                            <div class="text-sm text-slate-500">Package Price</div>
                            <div class="text-3xl font-bold text-slate-900">₹${pkg.price}</div>
                        </div>
                        <div class="bg-green-100 text-green-700 px-4 py-2 rounded-full font-bold text-sm">
                            Save ₹${pkg.savings}
                        </div>
                    </div>
                </div>
            `;

            modal.classList.remove('hidden');
        }

        function closeModal() {
            document.getElementById('package-modal').classList.add('hidden');
        }

        function showMessage(msg) {
            // Simple visual feedback since alert() is prohibited
            const toast = document.createElement('div');
            toast.className = 'fixed bottom-8 left-1/2 -translate-x-1/2 bg-slate-900 text-white px-6 py-3 rounded-full shadow-2xl z-50 font-medium animate-bounce';
            toast.innerText = msg;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }

        function toggleCart() {
            // Scroll to cart section on mobile
            document.getElementById('cart-items').scrollIntoView({ behavior: 'smooth' });
        }

        // Initialize empty state
        updateUI();
    </script>
</body>
</html>
